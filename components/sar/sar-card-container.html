<link href="../polymer/polymer.html" rel="import">

<link href="../firebase-element/firebase-collection.html" rel="import">
<link href="../neon-animation/neon-shared-element-animatable-behavior.html" rel="import">

<link href="../sar/sar-card.html" rel="import">


<dom-module id="sar-card-container">
  <style is="custom-style">
    :host {
      display: flex;
      flex-direction: row;
      flex-wrap: wrap;
      justify-content: center;
      align-items: stretch;
    }
  </style>
  <template>
      <firebase-collection
          order-by-child="title"
          log="true"
          location="https://sexy-anime-reviews.firebaseio.com/reviews"
          data="{{reviews}}"></firebase-collection>
      <template is="dom-repeat" items="[[reviews]]">
        <sar-card review="[[item]]" on-card-click="_onCardClick"></sar-card>
      </template>
  </template>
</dom-module>

<script>
</script>
<script>
  Polymer({
    is: 'sar-card-container',
    behaviors: [
      Polymer.NeonSharedElementAnimatableBehavior
    ],
    properties: {
      reviews: Object,
      animationConfig: {
        value: function() {
          var cards = Polymer.dom(this.root).querySelectorAll('.card');
          var cardsArray = Array.prototype.slice.call(cards);
          return {
            'entry': [{
              name: 'cascaded-animation',
              animation: 'transform-animation',
              transformFrom: 'translateY(100%)',
              nodes: cardsArray
            }],
            'exit': [{
              name: 'hero-animation',
              id: 'hero',
              fromPage: this,
              timing: {
                delay: 50
              }
            }, {
              name: 'cascaded-animation',
              animation: 'transform-animation',
              transformTo: 'translateY(100%)',
              nodedelay: 50
            }]
          };
        }
      }
    },
    _onCardClick: function(event) {
      var target = Polymer.dom(event).localTarget;
      this.sharedElements = {
        'hero': event.detail.cover
      };
      var nodesToExit = [];
      var cards = Polymer.dom(this.root).querySelectorAll('sar-card');
      for (var node, idx = 0; node = cards[idx]; idx++) {
        if (node !== target) {
          nodesToExit.push(node);
        }
      }
      this.animationConfig['exit'][1].nodes = nodesToExit;

      this.fire('card-selected', {review: event.detail.review});
    }
  });
</script>